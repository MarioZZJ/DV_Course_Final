<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--
    <link href="./static/css/bootstrap.min.css" rel="stylesheet" />
    <script src="./static/js/echarts.min.js" type="text/javascript"></script>
    <script src="./static/js/bootstrap.min.js" type="text/javascript"></script>
-->
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4/dist/echarts.min.js"></script>
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl@1/dist/echarts-gl.min.js"></script>
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat@1/dist/ecStat.min.js"></script>
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4/dist/extension/dataTool.min.js"></script>
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4/map/js/china.js"></script>
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4/map/js/world.js"></script>
    <script src="https://how2j.cn/study/jquery.min.js"></script>

    <!--预定义js-->
<script>
    var cal_option = {
                    tooltip: {
                        position: 'top'
                    },
                    visualMap: {
                        min: 500000,
                        max: 5000000,
                        calculable: true,
                        orient: 'horizontal',
                        left: 'center',
                        top: 'top'
                    },

                    calendar: [{
                        range: '2008',
                        cellSize: [18, 18]
                    }],

                    series: [{
                        type: 'heatmap',
                        coordinateSystem: 'calendar',
                        calendarIndex: 0,
                        data: null
                    }]

                };
    var pie_option = {
                title: [{
                    text: 'Trending Wiki Entry of Year 2008'
                }, {
                    subtext: 'alignTo: "none" (default)',
                    left: '10%',
                    top: '10%',
                    textAlign: 'center'
                }],
                series: [{
                    type: 'pie',
                    radius: '60%',
                    center: ['50%', '50%'],
                    data: null,
                    animation: true,
                    label: {
                        position: 'outer',
                        alignTo: 'none',
                        bleedMargin: 5
                    },
                    left: 0,
                    right: '10%',
                    top: 0,
                    bottom: 0
                }]
            };
    var sta_option = {
                dataset: {
                    source: null
                },
                grid: {containLabel: true},
                xAxis: {name: 'access_times'},
                yAxis: {type: 'category'},
                visualMap: {
                    orient: 'horizontal',
                    left: 'center',
                    min: 5000000,
                    max: 50000000,
                    text: ['High', 'Low'],
                    // Map the score column to color
                    dimension: 0,
                    inRange: {
                        color: ['#D7DA8B', '#E15457']
                    }
                },
                series: [
                    {
                        type: 'bar',
                        encode: {
                            // Map the "amount" column to X axis.
                            x: 'access_times',
                            // Map the "product" column to Y axis
                            y: 'keywd'
                        }
                    }
                ]
            };
    function reset(){
        $("#title").html("初始化中。。。")
        $.post(
            "/init/",
            {"type": "date"},
            function (result) {
                datalist = []
                for(key in result){
                    datalist.push([key,result[key]])
                }
                window.cal_option['series'][0]['data']=datalist
                if (window.cal_option && typeof window.cal_option === "object") {
                    calendar.setOption(window.cal_option, true);
                }
            })
        $.post(
            "/init/",
            {"type": "keywd"},
            function (result) {
                datalist = []
                var result_sorted = Object.keys(result).sort(function(a,b){ return result[b]-result[a]; });
                var i = 0;
                for(key of result_sorted){
                    var datadict = {}
                    datadict['name']=key;
                    datadict['value']=result[key]
                    datalist.push(datadict)
                    i+=1;
                    if(i>=15){break;}
                }
                window.pie_option['series'][0]['data'] = datalist
                if (window.pie_option && typeof window.pie_option === "object") {
                    pieChart.setOption(window.pie_option, true);
                }
        })
        $.post(
            "/init/",
            {"type": "keywd"},
            function (result) {
                datalist = []
                var result_sorted = Object.keys(result).sort(function(a,b){ return result[b]-result[a]; });
                datalist.push(['access_times','keywd'])
                var i = 0;
                for(key of result_sorted){
                    datalist.push([result[key],key])
                    i+=1;
                    if(i>=15){break;}
                }
                window.sta_option['dataset']['source'] = datalist
                if (window.sta_option && typeof window.sta_option === "object") {
                    stackChart.setOption(window.sta_option, true);
                    $("#title").html("All Year")
                }
        })

    }
    function postDate(data) {
        $("#title").html("Loading...")
        $.post(
            "/getdata/",
            {"type": "date","data":data},
            function (result) {
                datalist = []
                var result_sorted = Object.keys(result).sort(function(a,b){ return result[b]-result[a]; });
                var i = 0;
                for(key of result_sorted){
                    var datadict = {}
                    datadict['name']=key;
                    datadict['value']=result[key]
                    datalist.push(datadict)
                    i+=1;
                    if(i>=15){break;}
                }
                window.pie_option['title'][0]['text'] = 'Trending Wiki Entry of '+data
                window.pie_option['series'][0]['data'] = datalist
                if (window.pie_option && typeof window.pie_option === "object") {
                    pieChart.setOption(window.pie_option, true);
                }
                datalist = []
                var result_sorted = Object.keys(result).sort(function(a,b){ return result[b]-result[a]; });
                datalist.push(['access_times','keywd'])
                var i = 0;
                for(key of result_sorted){
                    datalist.push([result[key],key])
                    i+=1;
                    if(i>=15){break;}
                }
                window.sta_option['dataset']['source'] = datalist
                if (window.sta_option && typeof window.sta_option === "object") {
                    stackChart.setOption(window.sta_option, true);
                    $("#title").html(data)
                }
            })
    }
    function postWord(data) {
        $("#title").html("Loading")
        $.post(
            "/getdata/",
            {"type": "word","data":data},
            function (result) {
                datalist = []
                for(key in result){
                    datalist.push([key,result[key]])
                }
                window.cal_option['series'][0]['data']=datalist
                if (window.cal_option && typeof window.cal_option === "object") {
                    calendar.setOption(window.cal_option, true);
                    $("#title").html(data)
                }

            })
    }
</script>
</head>
<body style="background: #888888">
<div id="graph" class="display-flex">
<div id="calendar" style="width:1440px;height:300px;border:2px solid black;">Place Calendar Here</div>
<div id="pie" style="width:600px;height:400px;border:2px solid black;float:left">Place Pie Charts Here</div>
    <div style="width:100px;height:400px;border:2px solid black;float:left">
    <div id="title" style="width:100px;height:200px;border:2px solid black;">All Year</div>
    <button id="reset" style="width:100px;height:30px;border:2px solid silver;" onclick="reset()">Reset</button>
    </div>
<div id="stack" style="width:600px;height:400px;border:2px solid black;float:left">Place Stack Charts Here</div>
</div>

<!--日历图-->
<script>
    $("#title").html("加载中。。")
    var dom = document.getElementById("calendar");
    var calendar = echarts.init(dom);
    var app = {};
    $.post(
            "/init/",
            {"type": "date"},
            function (result) {
                datalist = []
                for(key in result){
                    datalist.push([key,result[key]])
                }
                window.cal_option['series'][0]['data']=datalist
                if (window.cal_option && typeof window.cal_option === "object") {
                    calendar.setOption(window.cal_option, true);
                }
            })

    calendar.on('click',function(params){
            var date = +echarts.number.parseDate(2008 + '-01-01');
            var end = +echarts.number.parseDate((+2008 + 1) + '-01-01');
            var dayTime = 3600 * 24 * 1000;
            var day = params.dataIndex
            date = date + day*dayTime;
            var time = echarts.format.formatTime('yyyy-MM-dd', date)
            postDate(time)
    })

</script>
<!--饼图-->
<script>
    var dom = document.getElementById("pie");
    var pieChart = echarts.init(dom);
    var app = {};
    $.post(
        "/init/",
        {"type": "keywd"},
        function (result) {
            datalist = []
            var result_sorted = Object.keys(result).sort(function(a,b){ return result[b]-result[a]; });
            var i = 0;
            for(key of result_sorted){
                var datadict = {}
                datadict['name']=key;
                datadict['value']=result[key]
                datalist.push(datadict)
                i+=1;
                if(i>=15){break;}
            }

            window.pie_option['series'][0]['data'] = datalist
                if (window.pie_option && typeof window.pie_option === "object") {
                    pieChart.setOption(window.pie_option, true);
                }
        })


    pieChart.on('click',function(params){
            var name = params.name;
            postWord(name);
            })
</script>
<!--柱状图-->
<script>
    var dom = document.getElementById("stack");
    var stackChart = echarts.init(dom);
    var app = {};
    $.post(
        "/init/",
        {"type": "keywd"},
        function (result) {
            datalist = []
            var result_sorted = Object.keys(result).sort(function(a,b){ return result[b]-result[a]; });
            datalist.push(['access_times','keywd'])
            var i = 0;
            for(key of result_sorted){
                datalist.push([result[key],key])
                i+=1;
                if(i>=15){break;}
            }
            window.sta_option['dataset']['source'] = datalist
                if (window.sta_option && typeof window.sta_option === "object") {
                    stackChart.setOption(window.sta_option, true);
                    $("#title").html("All Year")
                }
        })
    stackChart.on('click',function(params){
            var name = params.name;
            postWord(name);
            })

</script>

</body>
</html>